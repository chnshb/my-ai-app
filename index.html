<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConsensusAI - å…±è¯†å¯¼å‘å‹å¿ƒç†å’¨è¯¢å¹³å°</title>
    <style>
        /* ä¸“ä¸šå•†åŠ¡é£æ ¼ */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #1abc9c;
            --danger-color: #e74c3c;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
            --success-color: #27ae60;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        /* ä¸“ä¸šå¤´éƒ¨ */
        .navbar {
            background: white;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary-color);
            font-size: 24px;
            font-weight: 700;
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* ä¸»å®¹å™¨ */
        .app-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 25px;
            height: calc(100vh - 100px);
        }
        
        /* å·¦ä¾§é¢æ¿ - ä¼šè¯ç®¡ç† */
        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
        }
        
        /* ä¸­é—´ - å¤šäººèŠå¤©å®¤ */
        .chat-room {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* å³ä¾§ - ç”¨æˆ·é¢æ¿å’Œå·¥å…· */
        .right-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.08);
        }
        
        /* ä¸“ä¸šæŒ‰é’® */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }
        
        /* ç”¨æˆ·å¤´åƒ */
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        /* æ¶ˆæ¯æ ·å¼ */
        .message {
            max-width: 70%;
            margin: 15px;
            padding: 18px;
            border-radius: 12px;
            position: relative;
            animation: slideIn 0.3s ease;
        }
        
        .user-message {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        
        .ai-message {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            border-bottom-left-radius: 4px;
        }
        
        /* å…±è¯†è¿›åº¦æ¡ */
        .consensus-progress {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--secondary-color));
            transition: width 0.5s ease;
        }
        
        /* å…è´£å£°æ˜ */
        .disclaimer {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
            color: #856404;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 250px 1fr;
            }
            .right-panel {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            .sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="logo">
            <div class="logo-icon">C</div>
            <span>ConsensusAI</span>
        </div>
        <div style="display: flex; gap: 15px; align-items: center;">
            <div style="font-size: 14px; color: #666;">
                <span>ä¸“ä¸šç‰ˆ</span>
                <span style="margin: 0 10px">|</span>
                <span id="online-count">åœ¨çº¿: 2äºº</span>
            </div>
            <button class="btn btn-primary" onclick="showNewSessionModal()">
                <span>+</span> æ–°å»ºä¼šè¯
            </button>
        </div>
    </nav>
    
    <!-- ä¸»åº”ç”¨å®¹å™¨ -->
    <div class="app-container">
        <!-- å·¦ä¾§ï¼šä¼šè¯åˆ—è¡¨ -->
        <div class="sidebar">
            <h3 style="margin-bottom: 20px; color: var(--primary-color);">ä¼šè¯åˆ—è¡¨</h3>
            <div id="session-list">
                <!-- åŠ¨æ€åŠ è½½ä¼šè¯ -->
            </div>
            <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-color);">
                <button class="btn" onclick="inviteUsers()" style="width: 100%; background: #f8f9fa;">
                    <span>ğŸ‘¥</span> é‚€è¯·æˆå‘˜
                </button>
                <button class="btn" onclick="showSettings()" style="width: 100%; margin-top: 10px; background: #f8f9fa;">
                    <span>âš™ï¸</span> è®¾ç½®
                </button>
            </div>
        </div>
        
        <!-- ä¸­é—´ï¼šå¤šäººèŠå¤©å®¤ -->
        <div class="chat-room">
            <!-- èŠå¤©å¤´éƒ¨ -->
            <div style="padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 id="session-title">å®¶åº­æ²Ÿé€šåè°ƒä¼šè¯</h3>
                    <div style="display: flex; gap: 10px; margin-top: 5px; font-size: 14px; color: #666;">
                        <span>ğŸ‘¥ å‚ä¸è€…: å¼ ä¸‰, æå››</span>
                        <span>|</span>
                        <span>ğŸ• å·²è¿›è¡Œ: 15åˆ†é’Ÿ</span>
                    </div>
                </div>
                <div class="consensus-progress" style="width: 200px;">
                    <div class="progress-bar" style="width: 65%;"></div>
                </div>
            </div>
            
            <!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
            <div id="chat-messages" style="flex: 1; overflow-y: auto; padding: 20px;">
                <!-- æ¶ˆæ¯åŠ¨æ€åŠ è½½ -->
            </div>
            
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div style="padding: 20px; border-top: 1px solid var(--border-color); background: #f8f9fa;">
                <!-- å…è´£å£°æ˜ -->
                <div class="disclaimer" id="disclaimer">
                    <strong>é‡è¦æç¤ºï¼š</strong> AIä»…æä¾›å¼•å¯¼å’Œæé—®æ”¯æŒï¼Œä¸æä¾›ä¸“ä¸šå¿ƒç†å’¨è¯¢å»ºè®®ã€‚å¦‚éœ€ä¸“ä¸šå¸®åŠ©ï¼Œè¯·å’¨è¯¢è®¤è¯å¿ƒç†å’¨è¯¢å¸ˆã€‚
                </div>
                
                <!-- è¾“å…¥æ¡† -->
                <div style="display: flex; gap: 15px;">
                    <textarea 
                        id="message-input" 
                        placeholder="è¾“å…¥æ‚¨çš„æƒ³æ³•...ï¼ˆæŒ‰Ctrl+Enterå‘é€ï¼‰"
                        style="flex: 1; padding: 15px; border: 2px solid var(--border-color); border-radius: 10px; resize: none; min-height: 60px; font-family: inherit;"
                        rows="2"
                    ></textarea>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button class="btn btn-primary" onclick="sendMessage()">
                            <span>å‘é€</span>
                        </button>
                        <button class="btn" onclick="toggleVoiceInput()" style="background: #f8f9fa;">
                            <span>ğŸ¤</span>
                        </button>
                    </div>
                </div>
                
                <!-- å¿«é€Ÿå¼•å¯¼æŒ‰é’® -->
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="aiGuide('expressFeeling')" style="font-size: 13px; padding: 8px 15px; background: #f8f9fa;">
                        ğŸ’¬ è¡¨è¾¾æ„Ÿå—
                    </button>
                    <button class="btn" onclick="aiGuide('clarifyNeeds')" style="font-size: 13px; padding: 8px 15px; background: #f8f9fa;">
                        ğŸ¯ æ¾„æ¸…éœ€æ±‚
                    </button>
                    <button class="btn" onclick="aiGuide('findCommonGround')" style="font-size: 13px; padding: 8px 15px; background: #f8f9fa;">
                        ğŸ¤ å¯»æ‰¾å…±åŒç‚¹
                    </button>
                    <button class="btn" onclick="aiGuide('suggestSolution')" style="font-size: 13px; padding: 8px 15px; background: #f8f9fa;">
                        ğŸ’¡ æ–¹æ¡ˆå»ºè®®
                    </button>
                </div>
            </div>
        </div>
        
        <!-- å³ä¾§ï¼šç”¨æˆ·é¢æ¿ -->
        <div class="right-panel">
            <h3 style="margin-bottom: 20px; color: var(--primary-color);">ä¼šè¯æˆå‘˜</h3>
            <div id="user-list">
                <!-- ç”¨æˆ·åŠ¨æ€åŠ è½½ -->
            </div>
            
            <div style="margin-top: 30px;">
                <h4 style="margin-bottom: 15px; color: var(--primary-color);">å…±è¯†è¿›åº¦</h4>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ç†è§£é˜¶æ®µ</span>
                        <span>65%</span>
                    </div>
                    <div class="consensus-progress">
                        <div class="progress-bar" style="width: 65%;"></div>
                    </div>
                    <div style="font-size: 13px; color: #666; margin-top: 15px;">
                        å½“å‰å…±è¯†ç‚¹ï¼šåŒæ–¹å·²ç†è§£å½¼æ­¤éœ€æ±‚
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h4 style="margin-bottom: 15px; color: var(--primary-color);">å·¥å…·</h4>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn" onclick="exportSession()" style="justify-content: start; background: #f8f9fa;">
                        <span>ğŸ“¥</span> å¯¼å‡ºä¼šè¯è®°å½•
                    </button>
                    <button class="btn" onclick="showFileUpload()" style="justify-content: start; background: #f8f9fa;">
                        <span>ğŸ“</span> ä¸Šä¼ æ–‡ä»¶åˆ†æ
                    </button>
                    <button class="btn" onclick="showDataAnalysis()" style="justify-content: start; background: #f8f9fa;">
                        <span>ğŸ“Š</span> æƒ…ç»ªåˆ†ææŠ¥å‘Š
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container"></div>
    
    <script>
        // ================= æ ¸å¿ƒé…ç½® =================
        const APP_CONFIG = {
            appName: "ConsensusAI",
            version: "1.0.0",
            maxUsersPerSession: 20,
            sessionTimeout: 3600, // 1å°æ—¶
            aiGuidanceModes: {
                family: "å®¶åº­å…³ç³»åè°ƒ",
                couple: "ä¼´ä¾£æ²Ÿé€š",
                workplace: "èŒåœºåä½œ",
                friendship: "æœ‹å‹å…³ç³»"
            }
        };
        
        // ================= çŠ¶æ€ç®¡ç† =================
        let currentSession = null;
        let currentUsers = [];
        let chatHistory = [];
        let userProfile = {};
        
        // ================= åˆå§‹åŒ–å‡½æ•° =================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadSampleData();
        });
        
        function initializeApp() {
            // åŠ è½½ç”¨æˆ·é…ç½®
            loadUserProfile();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬
            setupEventListeners();
            
            // æ›´æ–°åœ¨çº¿çŠ¶æ€
            updateOnlineStatus();
        }
        
        function loadSampleData() {
            // ç¤ºä¾‹ä¼šè¯æ•°æ®
            currentSession = {
                id: 'session-001',
                title: 'å®¶åº­æ²Ÿé€šåè°ƒä¼šè¯',
                type: 'family',
                created: new Date(),
                users: [
                    { id: 'user-001', name: 'å¼ ä¸‰', role: 'çˆ¶äº²', color: '#3498db' },
                    { id: 'user-002', name: 'æå››', role: 'å„¿å­', color: '#2ecc71' }
                ],
                consensus: 65
            };
            
            // ç¤ºä¾‹æ¶ˆæ¯
            chatHistory = [
                {
                    id: 'msg-001',
                    userId: 'user-001',
                    userName: 'å¼ ä¸‰',
                    userRole: 'çˆ¶äº²',
                    content: 'æˆ‘å¸Œæœ›å„¿å­èƒ½æ›´ä¸“æ³¨äºå­¦ä¹ ï¼Œå°‘ç©æ‰‹æœºæ¸¸æˆã€‚',
                    timestamp: new Date(Date.now() - 3600000),
                    type: 'user'
                },
                {
                    id: 'msg-002',
                    userId: 'user-002',
                    userName: 'æå››',
                    userRole: 'å„¿å­',
                    content: 'æˆ‘è§‰å¾—å­¦ä¹ å‹åŠ›å¾ˆå¤§ï¼Œç©æ¸¸æˆæ˜¯æ”¾æ¾çš„æ–¹å¼ã€‚',
                    timestamp: new Date(Date.now() - 3540000),
                    type: 'user'
                },
                {
                    id: 'msg-003',
                    userId: 'ai',
                    userName: 'AIå¼•å¯¼å¸ˆ',
                    content: 'æˆ‘ç†è§£åŒæ–¹éƒ½æœ‰è‡ªå·±çš„éœ€æ±‚å’Œå›°æ‰°ã€‚è®©æˆ‘ä»¬å…ˆæ˜ç¡®ä¸€ä¸‹æ ¸å¿ƒé—®é¢˜ï¼šçˆ¶äº²å…³å¿ƒçš„æ˜¯å­¦ä¸šæˆç»©ï¼Œå„¿å­éœ€è¦çš„æ˜¯å‹åŠ›é‡Šæ”¾ã€‚æˆ‘ä»¬å¯ä»¥ä¸€èµ·å¯»æ‰¾æ—¢èƒ½ä¿è¯å­¦ä¹ æ•ˆæœï¼Œåˆèƒ½é€‚å½“æ”¾æ¾çš„æ–¹æ¡ˆå—ï¼Ÿ',
                    timestamp: new Date(Date.now() - 3500000),
                    type: 'ai'
                }
            ];
            
            // æ¸²æŸ“ç•Œé¢
            renderSession();
            renderMessages();
            renderUserList();
        }
        
        // ================= æ¸²æŸ“å‡½æ•° =================
        function renderSession() {
            if (currentSession) {
                document.getElementById('session-title').textContent = currentSession.title;
                updateConsensusProgress(currentSession.consensus);
            }
        }
        
        function renderMessages() {
            const container = document.getElementById('chat-messages');
            container.innerHTML = '';
            
            chatHistory.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.type === 'user' ? 'user-message' : 'ai-message'}`;
                
                // ç”¨æˆ·ä¿¡æ¯
                const userInfo = document.createElement('div');
                userInfo.style.cssText = 'display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 14px;';
                
                const avatar = document.createElement('div');
                avatar.className = 'user-avatar';
                avatar.style.background = msg.type === 'user' ? 
                    (currentSession.users.find(u => u.id === msg.userId)?.color || '#3498db') : 
                    'linear-gradient(135deg, #9b59b6, #8e44ad)';
                avatar.textContent = msg.userName.charAt(0);
                
                const infoText = document.createElement('div');
                infoText.innerHTML = `<strong>${msg.userName}</strong> ${msg.userRole ? `<span style="color: #666; font-size: 12px;">(${msg.userRole})</span>` : ''}`;
                
                userInfo.appendChild(avatar);
                userInfo.appendChild(infoText);
                
                // æ¶ˆæ¯å†…å®¹
                const content = document.createElement('div');
                content.textContent = msg.content;
                
                // æ—¶é—´æˆ³
                const time = document.createElement('div');
                time.style.cssText = 'font-size: 12px; color: #999; margin-top: 8px; text-align: right;';
                time.textContent = formatTime(msg.timestamp);
                
                messageDiv.appendChild(userInfo);
                messageDiv.appendChild(content);
                messageDiv.appendChild(time);
                
                container.appendChild(messageDiv);
            });
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            container.scrollTop = container.scrollHeight;
        }
        
        function renderUserList() {
            const container = document.getElementById('user-list');
            container.innerHTML = '';
            
            currentSession.users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.style.cssText = 'display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;';
                
                const avatar = document.createElement('div');
                avatar.className = 'user-avatar';
                avatar.style.background = user.color;
                avatar.textContent = user.name.charAt(0);
                
                const info = document.createElement('div');
                info.innerHTML = `
                    <div style="font-weight: 600;">${user.name}</div>
                    <div style="font-size: 13px; color: #666;">${user.role}</div>
                `;
                
                const status = document.createElement('div');
                status.style.cssText = 'width: 10px; height: 10px; background: #2ecc71; border-radius: 50%; margin-left: auto;';
                
                userDiv.appendChild(avatar);
                userDiv.appendChild(info);
                userDiv.appendChild(status);
                
                container.appendChild(userDiv);
            });
        }
        
        // ================= æ ¸å¿ƒåŠŸèƒ½ =================
        function sendMessage() {
            const input = document.getElementById('message-input');
            const content = input.value.trim();
            
            if (!content) return;
            
            // åˆ›å»ºæ¶ˆæ¯å¯¹è±¡
            const newMessage = {
                id: 'msg-' + Date.now(),
                userId: 'user-001', // å½“å‰ç”¨æˆ·ID
                userName: 'å¼ ä¸‰', // å½“å‰ç”¨æˆ·å
                userRole: 'çˆ¶äº²',
                content: content,
                timestamp: new Date(),
                type: 'user'
            };
            
            // æ·»åŠ åˆ°å†å²
            chatHistory.push(newMessage);
            
            // æ¸²æŸ“æ¶ˆæ¯
            renderMessages();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            input.value = '';
            
            // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
            adjustInputHeight();
            
            // AIè‡ªåŠ¨å“åº”ï¼ˆæ¨¡æ‹Ÿï¼‰
            setTimeout(() => {
                aiResponse(content);
            }, 1000);
        }
        
        function aiResponse(userMessage) {
            const responses = {
                lowConsensus: [
                    "æˆ‘æ³¨æ„åˆ°åŒæ–¹æœ‰ä¸åŒçš„çœ‹æ³•ã€‚è®©æˆ‘ä»¬å…ˆå„è‡ªè¡¨è¾¾ä¸€ä¸‹å¯¹è¿™ä¸ªé—®é¢˜çš„æœ€çœŸå®æ„Ÿå—å¥½å—ï¼Ÿ",
                    "çœ‹èµ·æ¥æˆ‘ä»¬éœ€è¦æ›´å¤šç†è§£å½¼æ­¤çš„è§’åº¦ã€‚æ‚¨èƒ½è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆè¿™ä»¶äº‹å¯¹æ‚¨å¦‚æ­¤é‡è¦å—ï¼Ÿ",
                    "æˆ‘ç†è§£è¿™å¯èƒ½æœ‰æŒ‘æˆ˜æ€§ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ä»ä¸€ä¸ªæ›´ä¸­ç«‹çš„è§’åº¦æ¥çœ‹è¿™ä¸ªé—®é¢˜å—ï¼Ÿ"
                ],
                mediumConsensus: [
                    "å¾ˆå¥½ï¼Œæˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†ä¸€äº›å…±åŒç‚¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥è®¨è®ºä¸€ä¸‹å„è‡ªçš„åº•çº¿éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ",
                    "æˆ‘æ¬£èµåŒæ–¹éƒ½æ„¿æ„æ²Ÿé€šçš„æ€åº¦ã€‚ç°åœ¨æˆ‘ä»¬æ˜¯å¦å¯ä»¥è€ƒè™‘ä¸€äº›æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Ÿ",
                    "è®©æˆ‘ä»¬è¯•ç€æŠŠå„è‡ªçš„éœ€æ±‚åˆ—å‡ºæ¥ï¼Œçœ‹çœ‹å“ªäº›æ˜¯å¯ä»¥äº’ç›¸æ»¡è¶³çš„ã€‚"
                ],
                highConsensus: [
                    "æˆ‘ä»¬å·²ç»å–å¾—äº†å¾ˆå¤§è¿›å±•ï¼æ˜¯å¦å¯ä»¥è€ƒè™‘ä¸€ä¸ªè¯•è¡Œæ–¹æ¡ˆï¼Œçœ‹çœ‹æ•ˆæœå¦‚ä½•ï¼Ÿ",
                    "åŸºäºç›®å‰çš„å…±è¯†ï¼Œæˆ‘å»ºè®®æˆ‘ä»¬å¯ä»¥åˆ¶å®šä¸€ä¸ªå…·ä½“çš„è¡ŒåŠ¨è®¡åˆ’ã€‚",
                    "å¾ˆé«˜å…´çœ‹åˆ°åŒæ–¹è¾¾æˆç†è§£ã€‚æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹è¾¾æˆçš„å…±è¯†ç‚¹å—ï¼Ÿ"
                ]
            };
            
            // æ ¹æ®å…±è¯†ç¨‹åº¦é€‰æ‹©å›å¤
            let responseType = 'lowConsensus';
            if (currentSession.consensus > 70) responseType = 'highConsensus';
            else if (currentSession.consensus > 40) responseType = 'mediumConsensus';
            
            const response = responses[responseType][Math.floor(Math.random() * responses[responseType].length)];
            
            const aiMessage = {
                id: 'msg-' + Date.now(),
                userId: 'ai',
                userName: 'AIå¼•å¯¼å¸ˆ',
                content: response + '\n\n<small style="color: #666;">è¯·æ³¨æ„ï¼šAIä»…æä¾›å¼•å¯¼æ”¯æŒï¼Œä¸æä¾›ä¸“ä¸šå»ºè®®ã€‚</small>',
                timestamp: new Date(),
                type: 'ai'
            };
            
            chatHistory.push(aiMessage);
            renderMessages();
            
            // æ›´æ–°å…±è¯†è¿›åº¦ï¼ˆæ¨¡æ‹Ÿï¼‰
            updateConsensusProgress(currentSession.consensus + 5);
        }
        
        // ================= è¾…åŠ©å‡½æ•° =================
        function aiGuide(mode) {
            const guides = {
                expressFeeling: "è¯·è¯•ç€ç”¨'æˆ‘æ„Ÿåˆ°...å½“...å› ä¸º...'çš„å¥å¼æ¥è¡¨è¾¾æ‚¨çš„æ„Ÿå—ã€‚",
                clarifyNeeds: "è¯·é—®æ‚¨åœ¨è¿™ä»¶äº‹ä¸­æœ€æ ¸å¿ƒçš„éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ˜¯æœ€ä¸èƒ½å¦¥åçš„ï¼Ÿ",
                findCommonGround: "æˆ‘ä»¬å¯ä»¥å…ˆåˆ—å‡ºåŒæ–¹éƒ½è®¤åŒçš„äº‹å®æˆ–ä»·å€¼è§‚å—ï¼Ÿ",
                suggestSolution: "åŸºäºç›®å‰çš„è®¨è®ºï¼Œæ‚¨è®¤ä¸ºå“ªäº›æ–¹æ¡ˆæ˜¯åŒæ–¹éƒ½å¯èƒ½æ¥å—çš„ï¼Ÿ"
            };
            
            const input = document.getElementById('message-input');
            input.value = guides[mode] + '\n' + (input.value || '');
            adjustInputHeight();
        }
        
        function updateConsensusProgress(percent) {
            if (percent > 100) percent = 100;
            if (percent < 0) percent = 0;
            
            currentSession.consensus = percent;
            document.querySelector('.progress-bar').style.width = percent + '%';
            
            // æ›´æ–°å…±è¯†æ–‡æœ¬
            let consensusText = '';
            if (percent < 30) consensusText = 'åˆæ­¥äº¤æµé˜¶æ®µ';
            else if (percent < 60) consensusText = 'ç›¸äº’ç†è§£é˜¶æ®µ';
            else if (percent < 80) consensusText = 'å…±è¯†å½¢æˆé˜¶æ®µ';
            else consensusText = 'æ¥è¿‘è¾¾æˆå…±è¯†';
            
            document.querySelector('.progress-bar').parentElement.nextElementSibling.textContent = 
                `å½“å‰å…±è¯†ç‚¹ï¼š${consensusText}`;
        }
        
        function adjustInputHeight() {
            const input = document.getElementById('message-input');
            input.style.height = 'auto';
            input.style.height = Math.min(input.scrollHeight, 120) + 'px';
        }
        
        function formatTime(date) {
            return date.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }
        
        function updateOnlineStatus() {
            const count = currentSession ? currentSession.users.length : 0;
            document.getElementById('online-count').textContent = `åœ¨çº¿: ${count}äºº`;
        }
        
        // ================= æ¨¡æ€æ¡†å‡½æ•° =================
        function showNewSessionModal() {
            alert('æ–°å»ºä¼šè¯åŠŸèƒ½ - å°†åœ¨å®Œæ•´ç‰ˆä¸­å®ç°');
            // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ›å»ºæ–°ä¼šè¯çš„å®Œæ•´é€»è¾‘
        }
        
        function inviteUsers() {
            alert('é‚€è¯·æˆå‘˜åŠŸèƒ½ - å°†åœ¨å®Œæ•´ç‰ˆä¸­å®ç°');
            // è¿™é‡Œå¯ä»¥æ·»åŠ é‚€è¯·ç”¨æˆ·çš„å®Œæ•´é€»è¾‘
        }
        
        function showSettings() {
            alert('è®¾ç½®åŠŸèƒ½ - å°†åœ¨å®Œæ•´ç‰ˆä¸­å®ç°');
            // è¿™é‡Œå¯ä»¥æ·»åŠ è®¾ç½®é¡µé¢çš„å®Œæ•´é€»è¾‘
        }
        
        // ================= å·¥å…·å‡½æ•° =================
        function toggleVoiceInput() {
            alert('è¯­éŸ³è¾“å…¥åŠŸèƒ½ - å°†åœ¨å®Œæ•´ç‰ˆä¸­å®ç°');
            // è¿™é‡Œå¯ä»¥æ·»åŠ è¯­éŸ³è¾“å…¥çš„å®Œæ•´é€»è¾‘
        }
        
        function exportSession() {
            const sessionData = {
                session: currentSession,
                messages: chatHistory,
                exportTime: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(sessionData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `consensusai-session-${currentSession.id}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('ä¼šè¯è®°å½•å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶');
        }
        
        function showFileUpload() {
            alert('æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ - å°†åœ¨å®Œæ•´ç‰ˆä¸­å®ç°');
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ–‡ä»¶ä¸Šä¼ çš„å®Œæ•´é€»è¾‘
        }
        
        function showDataAnalysis() {
            alert('æƒ…ç»ªåˆ†ææŠ¥å‘Š - å°†åœ¨å®Œæ•´ç‰ˆä¸­å®ç°');
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ•°æ®åˆ†æçš„å®Œæ•´é€»è¾‘
        }
        
        // ================= äº‹ä»¶ç›‘å¬ =================
        function setupEventListeners() {
            const input = document.getElementById('message-input');
            
            // Ctrl+Enter å‘é€
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // è¾“å…¥æ¡†é«˜åº¦è‡ªé€‚åº”
            input.addEventListener('input', adjustInputHeight);
        }
        
        // ================= ç”¨æˆ·é…ç½® =================
        function loadUserProfile() {
            const saved = localStorage.getItem('consensusai_profile');
            if (saved) {
                userProfile = JSON.parse(saved);
            } else {
                userProfile = {
                    name: 'å¼ ä¸‰',
                    subscription: 'professional',
                    settings: {
                        theme: 'light',
                        notifications: true,
                        autoSave: true
                    }
                };
            }
        }
        
        function saveUserProfile() {
            localStorage.setItem('consensusai_profile', JSON.stringify(userProfile));
        }
    </script>
</body>
</html>
